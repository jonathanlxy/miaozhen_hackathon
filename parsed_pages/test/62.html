<!DOCTYPE html>
<html>
 <head>
  <link href="http://blog.csdn.net/jiashuai94/article/details/78020994" rel="canonical"/>
  <script type="text/javascript">
   var username = "jiashuai94";var _blogger = username;var blog_address = "http://blog.csdn.net/jiashuai94";var static_host = "http://static.blog.csdn.net";
        var currentUserName = ""; var fileName = '78020994';var commentscount = 4; var islock = false
        window.quickReplyflag = true;
        var totalFloor=2;
                
                 var isBole = false;
                
                
                 var isDigg = false;
                
          
             var isExpert=false;
  </script>
  <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
  <meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
  <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
  <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
  <script src="http://c.csdnimg.cn/public/common/libs/jquery/jquery-1.9.1.min.js" type="text/javascript">
  </script>
  <link href="http://c.csdnimg.cn/public/common/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="http://c.csdnimg.cn/public/static/css/avatar.css" rel="stylesheet"/>
  <link href="http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/default.css" rel="stylesheet" type="text/css"/>
  <link href="http://static.blog.csdn.net/Skin/skin3-template/css/style.css?v=2017.033" rel="stylesheet"/>
  <link href="http://c.csdnimg.cn/public/common/toolbar/content_toolbar_css/content_toolbar.css" rel="stylesheet"/>
  <script src="http://static.blog.csdn.net/Skin/skin3-template/fonts/iconfont.js" type="text/javascript">
  </script>
  <script src="//csdnimg.cn/rabbit/exposure-click/main.js?v1.15.23">
  </script>
  <script charset="utf-8" src="http://c.csdnimg.cn/pubfooter/js/tracking_for_recommend.js?v=0911" type="text/javascript">
  </script>
  <script charset="utf-8" src="http://csdnimg.cn/pubfooter/js/tracking.js" type="text/javascript">
  </script>
  <script charset="utf-8" src="http://static.blog.csdn.net/scripts/cnick.js" type="text/javascript">
  </script>
  <link href="http://static.blog.csdn.net/code/prettify.css" rel="stylesheet"/>
  <script src="http://static.blog.csdn.net/code/prettify.js" type="text/javascript">
  </script>
  <script src="http://dup.baidustatic.com/js/ds.js">
  </script>
  <script type="text/javascript">
   // Traffic Stats of the entire Web site By baidu
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?6bcd52f51e9b3dce32bec4a3997715ac";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
        // Traffic Stats of the entire Web site By baidu end
  </script>
  <meta content="SurfaceView+MediaPlayer封装之路我的播放器叫做JsPlayer，喜欢的话，就给个star喽^_^https://github.com/shuaijia/JsPlayer这里我只介绍播放器封装思路，会贴出部分代码，如果大家想查看完整代码，可以去github查看，有不清楚或错误或改进的地方，可以issues 我！写在之前先上效果图：（1.5版本新增弹幕功能）为什么要用Surface" name="description"/>
  <meta content="mediaplayer" name="keywords"/>
  <meta content="no-siteapp" http-equiv="Cache-Control"/>
  <link href="#" media="handheld" rel="alternate"/>
  <meta content="5a59773ab8077d4a62bf469ab966a63b_1497598848" name="shenma-site-verification"/>
  <title>
   SurfaceView+MediaPlayer封装之路 - CSDN博客
  </title>
 </head>
 <body>
  <script domain="http://blog.csdn.net" id="toolbar-tpl-scriptId" prod="download" skin="black" src="http://c.csdnimg.cn/public/common/toolbar/js/content_toolbar.js" type="text/javascript">
  </script>
  <div class="container clearfix">
   <main>
    <article>
     <h1 class="csdn_top">
      SurfaceView+MediaPlayer封装之路
     </h1>
     <div class="article_bar clearfix">
      <div class="artical_tag">
       <span class="original">
        原创
       </span>
       <span class="time">
        2017年09月18日 16:50:18
       </span>
      </div>
      <ul class="article_tags clearfix csdn-tracking-statistics" data-mod="popu_377">
       <li class="tit">
        标签：
       </li>
       <li>
        <a href="http://so.csdn.net/so/search/s.do?q=mediaplayer&amp;t=blog" target="_blank">
         mediaplayer
        </a>
        <span>
         /
        </span>
       </li>
      </ul>
      <ul class="right_bar">
       <li>
        <button class="btn-noborder">
         <i class="icon iconfont icon-read">
         </i>
         <span class="txt">
          8327
         </span>
        </button>
       </li>
       <!--<li><button class="btn-noborder"><i class="icon iconfont icon-dashang-"></i><span class="txt">0</span></button></li>-->
       <li class="edit">
        <a class="btn-noborder" href="">
         <i class="icon iconfont icon-bianji">
         </i>
         <span class="txt">
          编辑
         </span>
        </a>
       </li>
       <li class="del">
        <a class="btn-noborder" onclick="javascript:deleteArticle(fileName);return false;">
         <i class="icon iconfont icon-shanchu">
         </i>
         <span class="txt">
          删除
         </span>
        </a>
       </li>
      </ul>
     </div>
     <div class="article_content csdn-tracking-statistics" data-dsm="post" data-mod="popu_307" id="article_content">
      <div class="markdown_views">
       <h2 id="surfaceviewmediaplayer封装之路">
        SurfaceView+MediaPlayer封装之路
       </h2>
       <p>
        <strong>
         我的播放器叫做JsPlayer，喜欢的话，就给个star喽^_^
         <a href="https://github.com/shuaijia/JsPlayer" target="_blank">
          https://github.com/shuaijia/JsPlayer
         </a>
        </strong>
       </p>
       <p>
        这里我只介绍播放器封装思路，会贴出部分代码，如果大家想查看完整代码，可以去github查看，有不清楚或错误或改进的地方，可以issues 我！
       </p>
       <h2 id="写在之前">
        写在之前
       </h2>
       <p>
        先上效果图：（
        <strong>
         1.5版本新增弹幕功能
        </strong>
        ）
       </p>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170919140145619?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170919140242276?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170925163230227?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <h3 id="为什么要用surfaceview">
        为什么要用SurfaceView
       </h3>
       <p>
        它继承自类View，因此它本质上是一个View。但与普通View不同的是，它有自己的Surface。而SurfaceView自带一个Surface，这个Surface在WMS中有自己对应的WindowState，在SF中也会有自己的Layer。虽然在App端它仍在View hierachy中，但在Server端（WMS和SF）中，它与宿主窗口是分离的。这样的好处是对这个
        <strong>
         Surface的渲染可以放到单独线程
        </strong>
        去做，渲染时可以有自己的GL context。这对于一些游戏、视频等性能相关的应用非常有益，因为它不会影响主线程对事件的响应。
       </p>
       <p>
        SurfaceView内部自己持有surface，surface 创建、销毁、大小改变时系统来处理的，通过surfaceHolder 的callback回调通知。当画布创建好时，可以将surface绑定到MediaPlayer中。SurfaceView如果为用户可见的时候，创建SurfaceView的SurfaceHolder用于显示视频流解析的帧图片，如果发现SurfaceView变为用户不可见的时候，则立即销毁SurfaceView的SurfaceHolder，以达到节约系统资源的目的。
       </p>
       <p>
        关于更多SurfaceView的介绍，可参考我写的另一片文章：
        <a href="http://blog.csdn.net/jiashuai94/article/details/77882644" target="_blank">
         http://blog.csdn.net/jiashuai94/article/details/77882644
        </a>
       </p>
       <h3 id="mediaplayer">
        MediaPlayer
       </h3>
       <p>
        MediaPlayer其实是一个封装的很好的音频、视频流媒体操作类，如果查看其源码，会发现其内部是调用的native方法，所以它其实是有C++实现的。既然是一个流媒体操作类，那么必然涉及到，播放、暂停、停止等操作，实际上MediaPlayer也为我们提供了相应的方法来直接操作流媒体。
       </p>
       <ul>
        <li>
         void statr()：开始或恢复播放。
        </li>
        <li>
         void stop()：停止播放。
        </li>
        <li>
         void pause()：暂停播放。
        </li>
        <li>
         void setDataSource(String path)：通过一个媒体资源的地址指定MediaPlayer的数据源，这里的path可以是一个本地路径，也可以是网络路径。
        </li>
       </ul>
       <p>
        当然还有其他很多的方法，例如获取视频时长、获取当前位置、定位到某个位置等等方法，就不再一一列举，阅读
        <strong>
         JsPlayer
        </strong>
        的源码便会有所了解。
       </p>
       <h3 id="播放器结构">
        播放器结构
       </h3>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170919142258355?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <h3 id="uml图">
        UML图
       </h3>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170918165320040?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <hr/>
       <p>
        已经对SurfaceView+MediaPlayer封装视屏播放器有了大致的了解，接下来就开始视屏播放器的封装之旅吧！
       </p>
       <h2 id="1工具类">
        1、工具类
       </h2>
       <p>
        工欲善其事，必先利其器！
       </p>
       <p>
        想封装结构清晰，使用方便的视频播放器，工具类是少不了的！JsPlayer主要用了以下几个工具类：
       </p>
       <ul>
        <li>
         DisplayUtils
        </li>
        <li>
         NetworkUtils
        </li>
        <li>
         StringUtils
        </li>
       </ul>
       <p>
        <strong>
         DisplayUtils
        </strong>
        ：负责界面展示相关工具，例如px、dp、sp的相互转换；获取屏幕宽高度；切换横屏、竖屏等；
       </p>
       <p>
        <strong>
         NetworkUtils
        </strong>
        ：判断手机是否联网；是否为wifi；是否是流量；网络状态等；
       </p>
       <p>
        <strong>
         StringUtils
        </strong>
        ：主要将long型毫秒转换为时间格式的字符串。
        <br/>
        代码就不贴了，很简单。大家想了解，去github中查看吧。
       </p>
       <hr/>
       <h2 id="2实体类">
        2、实体类
       </h2>
       <p>
        为了在使用视频播放器时规范传入的数据，同时也方便使用者调用和封装，故定义了视频详情的接口：其包含两个抽象方法，分别返回视频地址和视频标题。
       </p>
       <pre class="prettyprint"><code class=" hljs java"><span class="hljs-javadoc">/**
 * 视频数据类
 * 请实现本接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IVideoInfo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Serializable</span> {</span>

    <span class="hljs-javadoc">/**
     * 视频标题
     */</span>
    String getVideoTitle();

    <span class="hljs-javadoc">/**
     * 视频播放路径（本地或网络）
     */</span>
    String getVideoPath();

}</code></pre>
       <p>
        用户可根据项目实际情况对其进行扩展（
        <strong>
         需实现此接口即可
        </strong>
        ），比如默认图地址，点赞数，是否购买，弹幕信息等等。但
        <strong>
         视频标题和视频地址必须返回
        </strong>
        ！
       </p>
       <hr/>
       <h2 id="3回调相关">
        3、回调相关
       </h2>
       <p>
        大家都知道，VideoView或其他视频播放器在使用时，有准备好监听、播放完成监听、错误监听等等，可供开发者在对应情况进行对应处理；而且我们有时也需要在用户点击播放暂停、全屏、拖动进度条等情况下获得操作回调。因此，我们封装了两个回调接口：
       </p>
       <ul>
        <li>
         OnVideoControlListener：视频控制回调
        </li>
        <li>
         OnPlayerCallback：视频状态回调
        </li>
       </ul>
       <pre class="prettyprint"><code class=" hljs java"><span class="hljs-javadoc">/**
 * 视频控制监听
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OnVideoControlListener</span> {</span>

    <span class="hljs-javadoc">/**
     * 开始播放按钮
     */</span>
    <span class="hljs-keyword">void</span> onStartPlay();

    <span class="hljs-javadoc">/**
     * 返回
     */</span>
    <span class="hljs-keyword">void</span> onBack();

    <span class="hljs-javadoc">/**
     * 全屏
     */</span>
    <span class="hljs-keyword">void</span> onFullScreen();

    <span class="hljs-javadoc">/**
     * 错误后的重试
     */</span>
    <span class="hljs-keyword">void</span> onRetry(<span class="hljs-keyword">int</span> errorStatus);

}</code></pre>
       <pre class="prettyprint"><code class=" hljs java"><span class="hljs-javadoc">/**
 * 视频操作回调，是将系统MediaPlayer的常见回调封装
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OnPlayerCallback</span> {</span>

    <span class="hljs-javadoc">/**
     * 准备好
     */</span>
    <span class="hljs-keyword">void</span> onPrepared(MediaPlayer mp);

    <span class="hljs-javadoc">/**
     * 视频size变化
     */</span>
    <span class="hljs-keyword">void</span> onVideoSizeChanged(MediaPlayer mp, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height);

    <span class="hljs-javadoc">/**
     * 缓存更新变化
     *
     *<span class="hljs-javadoctag"> @param</span> percent 缓冲百分比
     */</span>
    <span class="hljs-keyword">void</span> onBufferingUpdate(MediaPlayer mp, <span class="hljs-keyword">int</span> percent);

    <span class="hljs-javadoc">/**
     * 播放完成
     */</span>
    <span class="hljs-keyword">void</span> onCompletion(MediaPlayer mp);

    <span class="hljs-javadoc">/**
     * 视频错误
     *<span class="hljs-javadoctag"> @param</span> what  错误类型
     *<span class="hljs-javadoctag"> @param</span> extra 特殊错误码
     */</span>
    <span class="hljs-keyword">void</span> onError(MediaPlayer mp, <span class="hljs-keyword">int</span> what, <span class="hljs-keyword">int</span> extra);

    <span class="hljs-javadoc">/**
     * 视频加载状态变化
     *
     *<span class="hljs-javadoctag"> @param</span> isShow 是否显示loading
     */</span>
    <span class="hljs-keyword">void</span> onLoadingChanged(<span class="hljs-keyword">boolean</span> isShow);

    <span class="hljs-javadoc">/**
     * 视频状态变化
     */</span>
    <span class="hljs-keyword">void</span> onStateChanged(<span class="hljs-keyword">int</span> curState);
}</code></pre>
       <p>
        当然了，各位使用上述两个回调时，必须先实现、再使用，当然也可以基于它拓展了！
       </p>
       <hr/>
       <h2 id="4自定义view">
        4、自定义view
       </h2>
       <p>
        关于播放器中涉及到的、需要自定义的view主要有手势调节进度、音量、亮度时的弹框、控制器界面、错误界面。
       </p>
       <p>
        <em>
         当然我们的JsPlayer视频播放器也是一自定义view，其手势控制也封装了一个view，这些我们稍后会详细介绍。
        </em>
       </p>
       <ul>
        <li>
         JsVideoProgressOverlay：  调节进度 框
        </li>
        <li>
         JsVideoSystemOverlay：   调节音量、亮度 框
        </li>
        <li>
         JsVideoErrorView：  错误界面
        </li>
        <li>
         JsVideoControllerView：  控制器
        </li>
       </ul>
       <p>
        我的思路是这样的：将错误界面JsVideoErrorView再封装到控制器中JsVideoControllerView，这样便于在出错时的处理；而调节进度等弹框、控制器，当然还有SurfaceView，加载中等，它们会一同封装到视频播放器JsPlayer的自定义View中。
       </p>
       <h3 id="jsvideoprogressoverlay">
        <strong>
         JsVideoProgressOverlay
        </strong>
       </h3>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170920141437268?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <pre class="prettyprint"><code class=" hljs java"><span class="hljs-javadoc">/**
 * 滑动快进快退进度框
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JsVideoProgressOverlay</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FrameLayout</span> {</span>

    <span class="hljs-keyword">private</span> ImageView mSeekIcon;
    <span class="hljs-keyword">private</span> TextView mSeekCurProgress;
    <span class="hljs-keyword">private</span> TextView mSeekDuration;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mDuration = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mDelSeekDialogProgress = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSeekDialogStartProgress = -<span class="hljs-number">1</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title">JsVideoProgressOverlay</span>(Context context) {
        <span class="hljs-keyword">super</span>(context);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">JsVideoProgressOverlay</span>(Context context, AttributeSet attrs) {
        <span class="hljs-keyword">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">JsVideoProgressOverlay</span>(Context context, AttributeSet attrs, <span class="hljs-keyword">int</span> defStyleAttr) {
        <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span>() {
        LayoutInflater.from(getContext()).inflate(R.layout.video_overlay_progress, <span class="hljs-keyword">this</span>);

        mSeekIcon = (ImageView) findViewById(R.id.iv_seek_direction);
        mSeekCurProgress = (TextView) findViewById(R.id.tv_seek_current_progress);
        mSeekDuration = (TextView) findViewById(R.id.tv_seek_duration);
    }

    <span class="hljs-javadoc">/**
     * 显示进度框
     *
     *<span class="hljs-javadoctag"> @param</span> delProgress 进度变化值
     *<span class="hljs-javadoctag"> @param</span> curPosition player当前进度
     *<span class="hljs-javadoctag"> @param</span> duration    player总长度
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show</span>(<span class="hljs-keyword">int</span> delProgress, <span class="hljs-keyword">int</span> curPosition, <span class="hljs-keyword">int</span> duration) {
        <span class="hljs-keyword">if</span> (duration &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 获取第一次显示时的开始进度</span>
        <span class="hljs-keyword">if</span> (mSeekDialogStartProgress == -<span class="hljs-number">1</span>) {
            Log.i(<span class="hljs-string">"DDD"</span>, <span class="hljs-string">"show: start seek = "</span> + mSeekDialogStartProgress);
            mSeekDialogStartProgress = curPosition;
        }

        <span class="hljs-keyword">if</span> (getVisibility() != View.VISIBLE) {
            setVisibility(View.VISIBLE);
        }

        mDuration = duration;
        mDelSeekDialogProgress -= delProgress;
        <span class="hljs-keyword">int</span> targetProgress = getTargetProgress();

        <span class="hljs-keyword">if</span> (delProgress &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 回退</span>
            mSeekIcon.setImageResource(R.mipmap.ic_video_back);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 前进</span>
            mSeekIcon.setImageResource(R.mipmap.ic_video_speed);
        }
        mSeekCurProgress.setText(StringUtils.stringForTime(targetProgress));
        mSeekDuration.setText(StringUtils.stringForTime(mDuration));
    }

    <span class="hljs-javadoc">/**
     * 获取滑动结束后的目标进度
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTargetProgress</span>() {
        <span class="hljs-keyword">if</span> (mDuration == -<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        }

        <span class="hljs-keyword">int</span> newSeekProgress = mSeekDialogStartProgress + mDelSeekDialogProgress;
        <span class="hljs-keyword">if</span> (newSeekProgress &lt;= <span class="hljs-number">0</span>) newSeekProgress = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (newSeekProgress &gt;= mDuration) newSeekProgress = mDuration;
        <span class="hljs-keyword">return</span> newSeekProgress;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hide</span>() {
        mDuration = -<span class="hljs-number">1</span>;
        mSeekDialogStartProgress = -<span class="hljs-number">1</span>;
        mDelSeekDialogProgress = -<span class="hljs-number">1</span>;
        setVisibility(GONE);
    }

}</code></pre>
       <p>
        调节系统属性弹框JsVideoSystemOverlay就不再贴出代码了，与上类似，这里我们只分享设计思路。
       </p>
       <p>
        注意：
       </p>
       <ul>
        <li>
         mDelSeekDialogProgress -= delProgress，因为向右滑动时传进来的delProgress是负数、向左滑动是正数，所以这里计算变化时是在自减。
        </li>
        <li>
         if (newSeekProgress &lt;= 0) newSeekProgress = 0;
         <br/>
         if (newSeekProgress &gt;= mDuration) newSeekProgress = mDuration;
         <br/>
         做了边界控制，防止计算出的数据超出范围而导致出错。
        </li>
       </ul>
       <h3 id="jsvideoerrorview">
        <strong>
         JsVideoErrorView
        </strong>
       </h3>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170920142641012?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <p>
        从界面来看很简单了！
       </p>
       <p>
        定义所有错误码常量（可换为枚举）：
       </p>
       <pre class="prettyprint"><code class=" hljs java"><span class="hljs-comment">// 正常状态</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATUS_NORMAL = <span class="hljs-number">0</span>;
<span class="hljs-comment">// 普通一场</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATUS_VIDEO_DETAIL_ERROR = <span class="hljs-number">1</span>;
<span class="hljs-comment">// 资源错误</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATUS_VIDEO_SRC_ERROR = <span class="hljs-number">2</span>;
<span class="hljs-comment">// 无WIFI</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATUS_UN_WIFI_ERROR = <span class="hljs-number">3</span>;
<span class="hljs-comment">// 无网络</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATUS_NO_NETWORK_ERROR = <span class="hljs-number">4</span>;</code></pre>
       <p>
        另外就是显示的控制：
       </p>
       <pre class="prettyprint"><code class=" hljs avrasm">switch (status) {
    case STATUS_VIDEO_DETAIL_ERROR:
        video_error_info<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"视频加载失败"</span>)<span class="hljs-comment">;</span>
        video_error_retry<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"点此重试"</span>)<span class="hljs-comment">;</span>
        <span class="hljs-keyword">break</span><span class="hljs-comment">;</span>
    case STATUS_VIDEO_SRC_ERROR:
        video_error_info<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"视频加载失败"</span>)<span class="hljs-comment">;</span>
        video_error_retry<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"点此重试"</span>)<span class="hljs-comment">;</span>
        <span class="hljs-keyword">break</span><span class="hljs-comment">;</span>
    case STATUS_NO_NETWORK_ERROR:
        video_error_info<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"网络连接异常，请检查网络设置后重试"</span>)<span class="hljs-comment">;</span>
        video_error_retry<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"重试"</span>)<span class="hljs-comment">;</span>
        <span class="hljs-keyword">break</span><span class="hljs-comment">;</span>
    case STATUS_UN_WIFI_ERROR:
        video_error_info<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"温馨提示：您正在使用非WiFi网络，播放将产生流量费用"</span>)<span class="hljs-comment">;</span>
        video_error_retry<span class="hljs-preprocessor">.setText</span>(<span class="hljs-string">"继续播放"</span>)<span class="hljs-comment">;</span>
        <span class="hljs-keyword">break</span><span class="hljs-comment">;</span>
}
</code></pre>
       <p>
        注意：对重试按钮的点击事件：错误view内置了视频控制回调OnVideoControlListener，点击重试时执行回调的重试按钮。
       </p>
       <h3 id="jsvideocontrollerview">
        <strong>
         JsVideoControllerView
        </strong>
       </h3>
       <p>
        先看布局：
       </p>
       <pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">include
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_controller_bottom"</span>
        <span class="hljs-attribute">layout</span>=<span class="hljs-value">"@layout/video_controller_bottom"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/player_lock_screen"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_centerVertical</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"10dp"</span>
        <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@mipmap/video_unlock"</span>
        <span class="hljs-attribute">android:visibility</span>=<span class="hljs-value">"gone"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">com.jia.jsplayer.view.JsVideoErrorView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_controller_error"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">include
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_controller_title"</span>
        <span class="hljs-attribute">layout</span>=<span class="hljs-value">"@layout/video_controller_title"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_back"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"32dp"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"44dp"</span>
        <span class="hljs-attribute">android:layout_alignTop</span>=<span class="hljs-value">"@id/video_controller_title"</span>
        <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"12dp"</span>
        <span class="hljs-attribute">android:scaleType</span>=<span class="hljs-value">"fitCenter"</span>
        <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@mipmap/ic_back_white"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/rl_pre"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"#000"</span>
        <span class="hljs-attribute">android:visibility</span>=<span class="hljs-value">"gone"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/iv_pre_play"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@mipmap/ic_video_play"</span>
            <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span></code></pre>
       <p>
        能够看出：主要分为底部控制部分（播放按钮、当前位置、总时长、进度条），头部控制部分（返回键、标题），出错界面、锁屏按钮和填充全屏的默认图。
       </p>
       <p>
        对控制器来说，我们应该关心这些：
        <br/>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170920144950780?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <p>
        首先我们必须传入MediaPlayer对象（关于它的封装稍后会详细介绍），因为我们各点击事件和拖动事件都在控制MediaPlayer，如播放按钮的点击事件，在控制视频的播放与暂停，进度条拖动完时，应控制视频定位 等。
       </p>
       <p>
        注意：
       </p>
       <ul>
        <li>
         对UI的更新全部提出方法，方便其他地方调用
        </li>
        <li>
         是否锁屏、控制器显示时长等都应有默认值
        </li>
        <li>
         显示控制器时，视频当前位置和更新的精度
        </li>
        <li>
         对全屏按钮、重试按钮的点击交给OnVideoControlListener来做
        </li>
       </ul>
       <p>
        我想着重讲一下
        <strong>
         控制器的隐藏和显示
        </strong>
        ：
       </p>
       <h4 id="1控制器一显示就获取mediaplayer的当前位置更新ui进度条当前播放位置并将当前位置返回">
        1、控制器一显示，就获取MediaPlayer的当前位置，更新UI（进度条，当前播放位置），并将当前位置返回：
       </h4>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-javadoc">/**
     * 设置进度，同时也返回进度
     *
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">setProgress</span>() {
        <span class="hljs-keyword">if</span> (mPlayer == <span class="hljs-keyword">null</span> || mDragging) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">int</span> position = mPlayer.getCurrentPosition();
        <span class="hljs-keyword">int</span> duration = mPlayer.getDuration();
        <span class="hljs-keyword">if</span> (mPlayerSeekBar != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// use long to avoid overflow</span>
                <span class="hljs-keyword">long</span> pos = <span class="hljs-number">1000</span>L * position / duration;
                mPlayerSeekBar.setProgress((<span class="hljs-keyword">int</span>) pos);
            }
            <span class="hljs-comment">// 设置缓冲进度</span>
            <span class="hljs-keyword">int</span> percent = mPlayer.getBufferPercentage();
            mPlayerSeekBar.setSecondaryProgress(percent * <span class="hljs-number">10</span>);
        }

        mVideoProgress.setText(StringUtils.stringForTime(position));
        mVideoDuration.setText(StringUtils.stringForTime(duration));

        <span class="hljs-keyword">return</span> position;
    }
</code></pre>
       <h4 id="2控制各ui布局显示开始发送消息">
        2、控制各UI布局显示，开始发送消息
       </h4>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-javadoc">/**
     * 显示控制器
     *
     *<span class="hljs-javadoctag"> @param</span> timeout 显示时长
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show</span>(<span class="hljs-keyword">int</span> timeout) {
        setProgress();

        <span class="hljs-keyword">if</span> (!isScreenLock) {
            mControllerBack.setVisibility(VISIBLE);
            mControllerTitle.setVisibility(VISIBLE);
            mControllerBottom.setVisibility(VISIBLE);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (!DisplayUtils.isPortrait(getContext())) {
                mControllerBack.setVisibility(GONE);
            }
            mControllerTitle.setVisibility(GONE);
            mControllerBottom.setVisibility(GONE);
        }

        <span class="hljs-keyword">if</span> (!DisplayUtils.isPortrait(getContext())) {
            mScreenLock.setVisibility(VISIBLE);
        }

        mShowing = <span class="hljs-keyword">true</span>;

        updatePausePlay();

        <span class="hljs-comment">// 开始显示</span>
        post(mShowProgress);

        <span class="hljs-keyword">if</span> (timeout &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 先移除之前的隐藏异步操作</span>
            removeCallbacks(mFadeOut);
            <span class="hljs-comment">//timeout后隐藏</span>
            postDelayed(mFadeOut, timeout);
        }
    }</code></pre>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-javadoc">/**
     * 异步操作隐藏
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Runnable mFadeOut = <span class="hljs-keyword">new</span> Runnable() {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
            hide();
        }
    };

    <span class="hljs-javadoc">/**
     * 异步操作显示
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Runnable mShowProgress = <span class="hljs-keyword">new</span> Runnable() {
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
            <span class="hljs-keyword">int</span> pos = setProgress();
            <span class="hljs-keyword">if</span> (!mDragging &amp;&amp; mShowing &amp;&amp; mPlayer.isPlaying()) {
                <span class="hljs-comment">// 解决1秒之内的误差，使得发送消息正好卡在整秒</span>
                Log.e(<span class="hljs-string">"TAG"</span>, <span class="hljs-string">"run: "</span> + (<span class="hljs-number">1000</span> - (pos % <span class="hljs-number">1000</span>)));
                postDelayed(mShowProgress, <span class="hljs-number">1000</span> - (pos % <span class="hljs-number">1000</span>));
            }
        }
    };</code></pre>
       <ul>
        <li>
         <strong>
          首先注意，每当开始发送消息，都应强制将之前的消息全部移除；
         </strong>
        </li>
        <li>
         <strong>
          发送两个消息：一个是计时的消息，每隔大约一秒获取当前位置并且更新UI，另一个是延迟显示时长后隐藏控制器；
         </strong>
        </li>
        <li>
         <strong>
          为什么每隔大约1秒更新一次UI呢，postDelayed(mShowProgress, 1000 - (pos % 1000)); 我做了一个修正操作，因为各消息可能会互相影响，其次就是发送消息时没有卡在视频的整秒位置上，而我们确实整1秒发送一条消息，会导致误差！
         </strong>
        </li>
       </ul>
       <p>
        如果大家还想了解其他功能，可以去github阅读我的源码
        <a href="https://github.com/shuaijia/JsPlayer" target="_blank">
         https://github.com/shuaijia/JsPlayer
        </a>
       </p>
       <hr/>
       <h2 id="5mediaplayer封装">
        5、MediaPlayer封装
       </h2>
       <p>
        主要封装了
       </p>
       <ul>
        <li>
         openVideo：播放视频，处理各回调
        </li>
        <li>
         start：开始播放
        </li>
        <li>
         pause：暂停播放
        </li>
        <li>
         seekTo：定位到
        </li>
        <li>
         reset：视频重置
        </li>
        <li>
         stop：停止播放
        </li>
        <li>
         isPlaying：是否正在播放
        </li>
        <li>
         getDuration：获取总时长
        </li>
        <li>
         getCurrentPosition：获取当前进度
        </li>
        <li>
         getBufferPercentage：获取缓冲进度 等
        </li>
       </ul>
       <p>
        定义了视频播放的所用状态值常量
       </p>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-comment">//出错状态</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATE_ERROR = -<span class="hljs-number">1</span>;
    <span class="hljs-comment">//通常状态</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATE_IDLE = <span class="hljs-number">0</span>;
    <span class="hljs-comment">//视频正在准备</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATE_PREPARING = <span class="hljs-number">1</span>;
    <span class="hljs-comment">//视频已经准备好</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATE_PREPARED = <span class="hljs-number">2</span>;
    <span class="hljs-comment">//视频正在播放</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATE_PLAYING = <span class="hljs-number">3</span>;
    <span class="hljs-comment">//视频暂停</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATE_PAUSED = <span class="hljs-number">4</span>;
    <span class="hljs-comment">//视频播放完成</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STATE_PLAYBACK_COMPLETED = <span class="hljs-number">5</span>;</code></pre>
       <pre class="prettyprint"><code class=" hljs cs">    <span class="hljs-comment">// 播放核心使用MediaPlayer</span>
    <span class="hljs-keyword">private</span> MediaPlayer player;
    <span class="hljs-comment">// 当前状态</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> curState = STATE_IDLE;
    <span class="hljs-comment">// 当前缓冲进度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> currentBufferPercentage;
    <span class="hljs-comment">// *视频路径</span>
    <span class="hljs-keyword">private</span> String path;

    <span class="hljs-comment">// 播放监听</span>
    <span class="hljs-keyword">private</span> OnPlayerCallback onPlayerListener;
    <span class="hljs-comment">// 播放视频承载的view</span>
    <span class="hljs-keyword">private</span> SurfaceHolder surfaceHolder;</code></pre>
       <p>
        封装了视频播放状态的判断
       </p>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isInPlaybackState</span>() {
        <span class="hljs-keyword">return</span> (player != <span class="hljs-keyword">null</span> &amp;&amp;
                curState != STATE_ERROR &amp;&amp;
                curState != STATE_IDLE &amp;&amp;
                curState != STATE_PREPARING);
    }</code></pre>
       <p>
        此方法会在其他的所有方法执行之前判断，如果返回false，则不进行开始播放、重新播放、拖动定位等操作。
       </p>
       <p>
        同时这些操作执行完后都会更新当前播放状态，防止视频不能播的情况下操作报错。如
       </p>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-javadoc">/**
     * 开始播放
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span>() {
        <span class="hljs-keyword">if</span> (isInPlaybackState()) {
            player.start();
            setCurrentState(STATE_PLAYING);
        }
    }</code></pre>
       <p>
        在openVideo中：
       </p>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openVideo</span>() {
        <span class="hljs-keyword">if</span> (path == <span class="hljs-keyword">null</span> || surfaceHolder == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span>;
        }

        reset();

        player = <span class="hljs-keyword">new</span> MediaPlayer();

        <span class="hljs-comment">// 准备好的监听</span>
        player.setOnPreparedListener(<span class="hljs-keyword">new</span> MediaPlayer.OnPreparedListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPrepared</span>(MediaPlayer mp) {
                <span class="hljs-comment">//因为后面播放时要判断当前视频状态，所以在此一定要先将状态改变为STATE_PREPARED</span>
                <span class="hljs-comment">//即已经准备好，否则在第一次打开视频时无法自动播放</span>
                setCurrentState(STATE_PREPARED);
                <span class="hljs-keyword">if</span> (onPlayerListener != <span class="hljs-keyword">null</span>) {
                    onPlayerListener.onPrepared(mp);
                }

            }
        });
        <span class="hljs-comment">// 缓冲监听</span>
        player.setOnBufferingUpdateListener(<span class="hljs-keyword">new</span> MediaPlayer.OnBufferingUpdateListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBufferingUpdate</span>(MediaPlayer mp, <span class="hljs-keyword">int</span> percent) {
                <span class="hljs-keyword">if</span> (onPlayerListener != <span class="hljs-keyword">null</span>) {
                    onPlayerListener.onBufferingUpdate(mp, percent);
                }
                currentBufferPercentage = percent;
            }
        });
        <span class="hljs-comment">// 播放完成监听</span>
        player.setOnCompletionListener(<span class="hljs-keyword">new</span> MediaPlayer.OnCompletionListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCompletion</span>(MediaPlayer mp) {
                <span class="hljs-keyword">if</span> (onPlayerListener != <span class="hljs-keyword">null</span>) {
                    onPlayerListener.onCompletion(mp);
                }
                setCurrentState(STATE_PLAYBACK_COMPLETED);
            }
        });
        <span class="hljs-comment">// 信息监听</span>
        player.setOnInfoListener(<span class="hljs-keyword">new</span> MediaPlayer.OnInfoListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onInfo</span>(MediaPlayer mp, <span class="hljs-keyword">int</span> what, <span class="hljs-keyword">int</span> extra) {
                <span class="hljs-keyword">if</span> (onPlayerListener != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-comment">// 701 加载中</span>
                    <span class="hljs-keyword">if</span> (what == MediaPlayer.MEDIA_INFO_BUFFERING_START) {
                        onPlayerListener.onLoadingChanged(<span class="hljs-keyword">true</span>);
                        <span class="hljs-comment">// 702 加载完成</span>
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (what == MediaPlayer.MEDIA_INFO_BUFFERING_END) {
                        onPlayerListener.onLoadingChanged(<span class="hljs-keyword">false</span>);
                    }
                }
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            }
        });
        <span class="hljs-comment">// 出错监听</span>
        player.setOnErrorListener(onErrorListener);
        <span class="hljs-comment">// 视频大小切换监听</span>
        player.setOnVideoSizeChangedListener(<span class="hljs-keyword">new</span> MediaPlayer.OnVideoSizeChangedListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onVideoSizeChanged</span>(MediaPlayer mp, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height) {
                <span class="hljs-keyword">if</span> (onPlayerListener != <span class="hljs-keyword">null</span>) {
                    onPlayerListener.onVideoSizeChanged(mp, width, height);
                }
            }
        });

        currentBufferPercentage = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-javadoc">/**
             * 在这里开始真正的播放
             */</span>
            player.setDataSource(path);
            player.setDisplay(surfaceHolder);
            player.setAudioStreamType(AudioManager.STREAM_MUSIC);
            player.setScreenOnWhilePlaying(<span class="hljs-keyword">true</span>);
            player.prepareAsync();
            Log.e(TAG, <span class="hljs-string">"openVideo: "</span> );
            setCurrentState(STATE_PREPARING);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            Log.e(TAG, <span class="hljs-string">"openVideo: "</span> + e.toString());
            setCurrentState(STATE_ERROR);
            onErrorListener.onError(player, MediaPlayer.MEDIA_ERROR_UNKNOWN, <span class="hljs-number">0</span>);
        }
    }</code></pre>
       <p>
        openVideo就是播放视频的核心方法：新建MediaPlayer对象；将视频播放的各回调交给OnPlayerCallback处理；将外部传进来的SurfaceHolder设置给MediaPlayer，并且prepareAsync之后就可以播放了，当然，不要忘了更新状态！
       </p>
       <blockquote>
        <p>
         SurfaceHolder是surface的抽象接口，使你可以控制surface的大小和格式， 以及在surface上编辑像素，和监视surace的改变。
         <br/>
         SurfaceHolder用于显示视频流解析的帧图片，如果发现SurfaceView变为用户不可见的时候，则立即销毁SurfaceView的SurfaceHolder，以达到节约系统资源的目的。
        </p>
       </blockquote>
       <hr/>
       <h2 id="6手势控制">
        6、手势控制
       </h2>
       <p>
        说到手势控制，主要是手势控制视频进度，手势控制音量和屏幕亮度。
       </p>
       <p>
        对于手势控制，我自定义了BehaviorView：让其实现GestureDetector的OnGestureListener
       </p>
       <pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VideoBehaviorView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FrameLayout</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">GestureDetector</span>.<span class="hljs-title">OnGestureListener</span>{</span></code></pre>
       <p>
        在此view中定义以下方法，
        <strong>
         实现更新UI，交由子类去复写
        </strong>
        ：
       </p>
       <pre class="prettyprint"><code class=" hljs cs">    <span class="hljs-comment">// 更新进度UI，由子类重写</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateSeekUI</span>(<span class="hljs-keyword">int</span> delProgress) {
        <span class="hljs-comment">// sub</span>
    }

    <span class="hljs-comment">// 更新音量UI，由子类重写</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateVolumeUI</span>(<span class="hljs-keyword">int</span> max, <span class="hljs-keyword">int</span> progress) {
        <span class="hljs-comment">// sub</span>
    }

    <span class="hljs-comment">// 更新亮度UI，由子类重写</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateLightUI</span>(<span class="hljs-keyword">int</span> max, <span class="hljs-keyword">int</span> progress) {
        <span class="hljs-comment">// sub</span>
    }</code></pre>
       <p>
        我的思路是将view的
        <strong>
         触摸事件全部交给GestureDetector处理
        </strong>
        ：
       </p>
       <pre class="prettyprint"><code class=" hljs cs">    @Override
    <span class="hljs-keyword">public</span> boolean <span class="hljs-title">onTouchEvent</span>(MotionEvent <span class="hljs-keyword">event</span>) {
        mGestureDetector.onTouchEvent(<span class="hljs-keyword">event</span>);
        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">event</span>.getAction() &amp; MotionEvent.ACTION_MASK) {
            <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:
            <span class="hljs-keyword">case</span> MotionEvent.ACTION_OUTSIDE:
            <span class="hljs-keyword">case</span> MotionEvent.ACTION_CANCEL:
                endGesture(mFingerBehavior);
                <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }</code></pre>
       <p>
        当手指按下时，重置手指行为，获取当前音量、亮度
       </p>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onDown</span>(MotionEvent e) {
        <span class="hljs-comment">//重置 手指行为</span>
        mFingerBehavior = -<span class="hljs-number">1</span>;
        mCurrentVolume = am.getStreamVolume(AudioManager.STREAM_MUSIC);
        <span class="hljs-keyword">try</span> {
            mCurrentBrightness = (<span class="hljs-keyword">int</span>) (activity.getWindow().getAttributes().screenBrightness * mMaxBrightness);
        } <span class="hljs-keyword">catch</span> (Exception exception) {
            exception.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }</code></pre>
       <p>
        在onScroll方法中:
       </p>
       <p>
        判断决定当前为何种类型手势：左右滑动为调节进度，左半屏上下滑动为调节亮度，右半屏上下滑动为调节音量
       </p>
       <pre class="prettyprint"><code class=" hljs java">        <span class="hljs-javadoc">/**
         * 根据手势起始2个点断言 后续行为. 规则如下:
         *  屏幕切分为:
         *  1.左右扇形区域为视频进度调节
         *  2.上下扇形区域 左半屏亮度调节 后半屏音量调节.
         */</span>
        <span class="hljs-keyword">if</span> (mFingerBehavior &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">float</span> moveX = e2.getX() - e1.getX();
            <span class="hljs-keyword">float</span> moveY = e2.getY() - e1.getY();
            <span class="hljs-comment">// 如果横向滑动距离大于纵向滑动距离，则认为在调节进度</span>
            <span class="hljs-keyword">if</span> (Math.abs(moveX) &gt;= Math.abs(moveY))
                mFingerBehavior = FINGER_BEHAVIOR_PROGRESS;
                <span class="hljs-comment">// 否则为调节音量或亮度</span>
                <span class="hljs-comment">// 按下位置在屏幕左半边，则是调节亮度</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e1.getX() &lt;= width / <span class="hljs-number">2</span>) mFingerBehavior = FINGER_BEHAVIOR_BRIGHTNESS;
                <span class="hljs-comment">// 按下位置在屏幕右半边，则是在调节音量</span>
            <span class="hljs-keyword">else</span> mFingerBehavior = FINGER_BEHAVIOR_VOLUME;
        }</code></pre>
       <p>
        手势处理
       </p>
       <pre class="prettyprint"><code class=" hljs cs">        <span class="hljs-keyword">switch</span> (mFingerBehavior) {
            <span class="hljs-keyword">case</span> FINGER_BEHAVIOR_PROGRESS: { <span class="hljs-comment">// 进度变化</span>
                <span class="hljs-comment">// 默认滑动一个屏幕 视频移动八分钟.</span>
                <span class="hljs-keyword">int</span> delProgress = (<span class="hljs-keyword">int</span>) (<span class="hljs-number">1.0</span>f * distanceX / width * <span class="hljs-number">480</span> * <span class="hljs-number">1000</span>);
                <span class="hljs-comment">// 更新快进弹框</span>
                updateSeekUI(delProgress);
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">case</span> FINGER_BEHAVIOR_VOLUME: { <span class="hljs-comment">// 音量变化</span>
                <span class="hljs-keyword">float</span> progress = mMaxVolume * (distanceY / height) + mCurrentVolume;

                <span class="hljs-comment">// 控制调节临界范围</span>
                <span class="hljs-keyword">if</span> (progress &lt;= <span class="hljs-number">0</span>) progress = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (progress &gt;= mMaxVolume) progress = mMaxVolume;

                am.setStreamVolume(AudioManager.STREAM_MUSIC, Math.round(progress), <span class="hljs-number">0</span>);
                updateVolumeUI(mMaxVolume, Math.round(progress));
                <span class="hljs-comment">// 更新当前值</span>
                mCurrentVolume = progress;
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">case</span> FINGER_BEHAVIOR_BRIGHTNESS: { <span class="hljs-comment">// 亮度变化</span>
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 如果系统亮度为自动调节，则改为手动调节</span>
                    <span class="hljs-keyword">if</span> (Settings.System.getInt(getContext().getContentResolver(), Settings.System.SCREEN_BRIGHTNESS_MODE)
                            == Settings.System.SCREEN_BRIGHTNESS_MODE_AUTOMATIC) {
                        Settings.System.putInt(getContext().getContentResolver(), Settings.System.SCREEN_BRIGHTNESS_MODE,
                                Settings.System.SCREEN_BRIGHTNESS_MODE_MANUAL);
                    }

                    <span class="hljs-keyword">int</span> progress = (<span class="hljs-keyword">int</span>) (mMaxBrightness * (distanceY / height) + mCurrentBrightness);

                    <span class="hljs-comment">// 控制调节临界范围</span>
                    <span class="hljs-keyword">if</span> (progress &lt;= <span class="hljs-number">0</span>) progress = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">if</span> (progress &gt;= mMaxBrightness) progress = mMaxBrightness;

                    Window window = activity.getWindow();
                    WindowManager.LayoutParams <span class="hljs-keyword">params</span> = window.getAttributes();
                    <span class="hljs-keyword">params</span>.screenBrightness = progress / (<span class="hljs-keyword">float</span>) mMaxBrightness;
                    window.setAttributes(<span class="hljs-keyword">params</span>);

                    updateLightUI(mMaxBrightness, progress);
                    <span class="hljs-comment">// 更新当前值</span>
                    mCurrentBrightness = progress;
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    e.printStackTrace();
                }
                <span class="hljs-keyword">break</span>;
            }
        }</code></pre>
       <p>
        注意：
       </p>
       <ul>
        <li>
         <strong>
          所有的更新UI操作全部交由子类实现
         </strong>
        </li>
        <li>
         <strong>
          注意临界范围的控制
         </strong>
        </li>
        <li>
         <strong>
          控制进度时，百分比最后乘以8分钟，以达到较为适中的用户体验
         </strong>
         ，防止视频时长过大或太小情况下，拖动调节进度变化太过明显或效果不明显。
        </li>
       </ul>
       <hr/>
       <h2 id="7播放器jsplayer封装">
        7、播放器JsPlayer封装
       </h2>
       <p>
        先来看看布局
       </p>
       <pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">SurfaceView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_surface"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">com.jia.jsplayer.view.JsVideoControllerView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_controller"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">include
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_loading"</span>
        <span class="hljs-attribute">layout</span>=<span class="hljs-value">"@layout/video_controller_loading"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">com.jia.jsplayer.view.JsVideoSystemOverlay
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_system_overlay"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:visibility</span>=<span class="hljs-value">"gone"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">com.jia.jsplayer.view.JsVideoProgressOverlay
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/video_progress_overlay"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:visibility</span>=<span class="hljs-value">"gone"</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span></code></pre>
       <p>
        JsPlayer视频播放器集成自上一步中的VideoBehaviorView，注意复写VideoBehaviorView的更新UI方法。
       </p>
       <pre class="prettyprint"><code class=" hljs cs">    <span class="hljs-keyword">private</span> SurfaceView surfaceView;
    <span class="hljs-keyword">private</span> View loadingView;
    <span class="hljs-keyword">private</span> JsVideoProgressOverlay progressView;
    <span class="hljs-keyword">private</span> JsVideoSystemOverlay systemView;
    <span class="hljs-keyword">private</span> JsVideoControllerView mediaController;

    <span class="hljs-keyword">private</span> JsMediaPlayer mMediaPlayer;</code></pre>
       <p>
        内置封装过得JsMediaPlayer 对象，控制器、和SurfaceView，还有网络状态广播接收器。
       </p>
       <p>
        初始化player，创建JsMediaPlayer对象，设置视频播放回调处理，然后将其设置给ControllerView。
       </p>
       <p>
        注意：
       </p>
       <ul>
        <li>
         在准备好的监听中，mediaPlayer执行开始播放，控制器展示，错误界面隐藏。
        </li>
        <li>
         在播放出错时控制器检查错误类型并展示
        </li>
        <li>
         在加载状态发生改变时隐藏和展示加载中
        </li>
       </ul>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initPlayer</span>() {
        mMediaPlayer = <span class="hljs-keyword">new</span> JsMediaPlayer();

        <span class="hljs-comment">// todo 这里可以优化，将这些回调全部暴露出去</span>
        mMediaPlayer.setOnPlayerListener(<span class="hljs-keyword">new</span> OnPlayerCallback() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPrepared</span>(MediaPlayer mp) {
                Log.e(TAG, <span class="hljs-string">"onPrepared: "</span> );
                mMediaPlayer.start();
                mediaController.show();
                mediaController.hideErrorView();
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onVideoSizeChanged</span>(MediaPlayer mp, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height) {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBufferingUpdate</span>(MediaPlayer mp, <span class="hljs-keyword">int</span> percent) {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCompletion</span>(MediaPlayer mp) {
                mediaController.updatePausePlay();
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span>(MediaPlayer mp, <span class="hljs-keyword">int</span> what, <span class="hljs-keyword">int</span> extra) {
                mediaController.checkShowError(<span class="hljs-keyword">false</span>);
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLoadingChanged</span>(<span class="hljs-keyword">boolean</span> isShow) {
                <span class="hljs-keyword">if</span> (isShow) showLoading();
                <span class="hljs-keyword">else</span> hideLoading();
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStateChanged</span>(<span class="hljs-keyword">int</span> curState) {
                <span class="hljs-keyword">switch</span> (curState) {
                    <span class="hljs-keyword">case</span> JsMediaPlayer.STATE_IDLE:
                        am.abandonAudioFocus(<span class="hljs-keyword">null</span>);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> JsMediaPlayer.STATE_PREPARING:
                        am.requestAudioFocus(<span class="hljs-keyword">null</span>, AudioManager.STREAM_MUSIC, AudioManager.AUDIOFOCUS_GAIN);
                        <span class="hljs-keyword">break</span>;
                }
            }
        });

        mediaController.setMediaPlayer(mMediaPlayer);
    }</code></pre>
       <p>
        给SurfaceView设置Callback，返回SurfaceHolder后设置给JsMediaPlayer
       </p>
       <pre class="prettyprint"><code class=" hljs java">        surfaceView.getHolder().addCallback(<span class="hljs-keyword">new</span> SurfaceHolder.Callback() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">surfaceCreated</span>(SurfaceHolder holder) {
                Log.e(TAG, <span class="hljs-string">"surfaceCreated: "</span> );
                initWidth = getWidth();
                initHeight = getHeight();

                <span class="hljs-keyword">if</span> (mMediaPlayer != <span class="hljs-keyword">null</span>) {
                    mMediaPlayer.setSurfaceHolder(holder);
                }
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">surfaceChanged</span>(SurfaceHolder holder, <span class="hljs-keyword">int</span> format, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height) {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">surfaceDestroyed</span>(SurfaceHolder holder) {

            }
        });</code></pre>
       <p>
        设置路径，开始播放
       </p>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPath</span>(<span class="hljs-keyword">final</span> IVideoInfo video) {
        <span class="hljs-keyword">if</span> (video == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span>;
        }

        mMediaPlayer.reset();

        String videoPath = video.getVideoPath();
        mediaController.setVideoInfo(video);
        mMediaPlayer.setPath(videoPath);

    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startPlay</span>(){
        mMediaPlayer.openVideo();
    }</code></pre>
       <p>
        更新UI
       </p>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateSeekUI</span>(<span class="hljs-keyword">int</span> delProgress) {
        progressView.show(delProgress, mMediaPlayer.getCurrentPosition(), mMediaPlayer.getDuration());
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateVolumeUI</span>(<span class="hljs-keyword">int</span> max, <span class="hljs-keyword">int</span> progress) {
        systemView.show(JsVideoSystemOverlay.SystemType.VOLUME, max, progress);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateLightUI</span>(<span class="hljs-keyword">int</span> max, <span class="hljs-keyword">int</span> progress) {
        systemView.show(JsVideoSystemOverlay.SystemType.BRIGHTNESS, max, progress);
    }</code></pre>
       <p>
        当然不会忘记封装播放、暂停、停止、定位、获取总时长等等的基本方法，这里就不再累赘。
       </p>
       <hr/>
       <h2 id="8使用">
        8、使用
       </h2>
       <h3 id="涉及到播放网路视频权限少不了">
        涉及到播放网路视频，权限少不了
       </h3>
       <pre class="prettyprint"><code class=" hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.INTERNET"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.READ_EXTERNAL_STORAGE"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span></code></pre>
       <p>
        <strong>
         播放本地视频别忘了6.0权限适配
        </strong>
       </p>
       <h3 id="布局中添加">
        布局中添加
       </h3>
       <h3 id="代码中">
        代码中
       </h3>
       <pre class="prettyprint"><code class=" hljs java">        player = (JsPlayer) findViewById(R.id.player);

        player.setOnVideoControlListener(<span class="hljs-keyword">new</span> OnVideoControlListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStartPlay</span>() {
                player.startPlay();
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBack</span>() {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFullScreen</span>() {
                DisplayUtils.toggleScreenOrientation(MainActivity.<span class="hljs-keyword">this</span>);
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRetry</span>(<span class="hljs-keyword">int</span> errorStatus) {

            }
        });

        player.setPath(<span class="hljs-keyword">new</span> VideoInfo(<span class="hljs-string">"艺术人生"</span>, path));</code></pre>
       <h3 id="生命周期绑定">
        生命周期绑定
       </h3>
       <pre class="prettyprint"><code class=" hljs java">    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStop</span>() {
        <span class="hljs-keyword">super</span>.onStop();
        player.onStop();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDestroy</span>() {
        <span class="hljs-keyword">super</span>.onDestroy();
        player.onDestroy();
    }</code></pre>
       <h3 id="全屏操作">
        全屏操作
       </h3>
       <pre class="prettyprint"><code class=" hljs java">
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigurationChanged</span>(Configuration newConfig) {
        <span class="hljs-keyword">super</span>.onConfigurationChanged(newConfig);
        <span class="hljs-keyword">if</span> (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT) {
            getWindow().clearFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE) {
            getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBackPressed</span>() {
        <span class="hljs-keyword">if</span> (!DisplayUtils.isPortrait(<span class="hljs-keyword">this</span>)) {
            <span class="hljs-keyword">if</span> (!player.isLock()) {
                DisplayUtils.toggleScreenOrientation(<span class="hljs-keyword">this</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">super</span>.onBackPressed();
        }
    }</code></pre>
       <p>
        注意所在Activity在清单文件中应设置
        <strong>
         android:configChanges=”orientation|keyboardHidden|screenSize”
        </strong>
       </p>
       <h3 id="这样就ok了播放器封装完美完成">
        这样就ok了，播放器封装完美完成！
       </h3>
       <h3 id="希望对大家有所帮助">
        希望对大家有所帮助！
       </h3>
       <p>
        <img alt="这里写图片描述" src="http://img.blog.csdn.net/20170927150026128?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhc2h1YWk5NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" title=""/>
       </p>
       <h3 id="扫描二维码加入我们获取更多资讯">
        扫描二维码，加入我们，获取更多资讯！
       </h3>
       <link href="http://static.blog.csdn.net/public/res-min/markdown_views.css?v=2.0" rel="stylesheet"/>
      </div>
      <link href="http://static.blog.csdn.net/public/res-min/markdown_views.css?v=2.0" rel="stylesheet"/>
     </div>
    </article>
    <div class="readall_box csdn-tracking-statistics" data-mod="popu_376">
     <div class="read_more_mask">
     </div>
     <a class="btn btn-large btn-gray-fred read_more_btn" target="_self">
      阅读全文
     </a>
    </div>
    <div class="article_copyright">
     版权声明：本文为博主原创文章，未经博主允许不得转载。
    </div>
    <!--  <div class="reward_box">
            <div class="tit">
              <button class="btn_reward"><i class="icon iconfont icon-dashang-"></i></button>
            </div>
            <dl class="clearfix">
              <dt><a href="#" target="_blank">近期打赏</a></dt>
              <dd><a href="#" target="_blank"><img src="http://avatar.csdn.net/9/3/2/2_nzf_001.jpg" alt="聂兆芳" title="聂兆芳"></a></dd>
              <dd><a href="#" target="_blank"><img src="http://avatar.csdn.net/9/3/2/2_nzf_001.jpg" alt="聂兆芳" title="聂兆芳"></a></dd>
              <dd><a href="#" target="_blank"><img src="http://avatar.csdn.net/9/3/2/2_nzf_001.jpg" alt="聂兆芳" title="聂兆芳"></a></dd>
              <dd><a href="#" target="_blank"><img src="http://avatar.csdn.net/9/3/2/2_nzf_001.jpg" alt="聂兆芳" title="聂兆芳"></a></dd>
              <dd><a href="#" target="_blank"><img src="http://avatar.csdn.net/9/3/2/2_nzf_001.jpg" alt="聂兆芳" title="聂兆芳"></a></dd>
            </dl>
          </div>-->
    <ul class="article_collect clearfix csdn-tracking-statistics" data-mod="popu_378">
     <li class="tit">
      本文已收录于以下专栏：
     </li>
    </ul>
    <div class="comment_box clearfix">
     <div id="comment_form">
      <div id="commentsbmitarear">
       <!-- <h6><span>4</span>条评论</h6> -->
       <!--          <dl class="clearfix" id="commentbox">
                        <dt>
                            <a href="http://my.csdn.net/"><img src="" ></a>
                        </dt>
                        <dd>
                            <a href="http://my.csdn.net/" target="_blank"></a>
                        </dd>
                        <dd class="txt_tip"><span id="tip_comment" class="tip"></span></dd>
                    </dl> -->
       <div class="comment_area clearfix">
        <div class="userimg">
         <a href="http://my.csdn.net/">
          <img src=""/>
         </a>
        </div>
        <form action="/jiashuai94/comment/submit?id=78020994" id="commentform" method="post" onsubmit="return subform(this);">
         <textarea class="comment_content" id="comment_content" name="comment_content" placeholder="发表你的评论"></textarea>
         <div class="bot_bar clearfix">
          <div class="add_code" id="ubbtools">
           <a code="code" href="#insertcode" target="_self">
            <i class="icon iconfont icon-daima">
            </i>
           </a>
          </div>
          <input id="comment_replyId" name="comment_replyId" type="hidden"/>
          <input id="comment_userId" name="comment_userId" type="hidden" value=""/>
          <input id="commentId" name="commentId" type="hidden" value=""/>
          <input class="btn btn-redborder" type="submit" value="发表评论"/>
          <span class="tip" id="tip_comment">
           <div class="csdn-tracking-statistics" data-mod="popu_384" style="display: none;">
            <a class="comment_area_btn" href="#" target="_blank">
             发表评论
            </a>
           </div>
           <div code="code" id="lang_list">
            <a class="long_name" href="#html" style="width:95px;" target="_self">
             HTML/XML
            </a>
            <a class="long_name" href="#objc" style="width:95px;" target="_self">
             objective-c
            </a>
            <a class="zhong_name" href="#delphi" style="width:58px;" target="_self">
             Delphi
            </a>
            <a class="zhong_name" href="#ruby" target="_self">
             Ruby
            </a>
            <a href="#php" target="_self">
             PHP
            </a>
            <a class="duan_name" href="#csharp" target="_self">
             C#
            </a>
            <a class="duan_name" href="#cpp" style=" border-right: none;" target="_self">
             C++
            </a>
            <a class="long_name" href="#javascript" style=" border-bottom:none;width:95px;" target="_self">
             JavaScript
            </a>
            <a class="long_name" href="#vb" style=" border-bottom:none;width:95px;" target="_self">
             Visual Basic
            </a>
            <a class="zhong_name" href="#python" style=" border-bottom:none;" target="_self">
             Python
            </a>
            <a class="zhong_name" href="#java" style=" border-bottom:none;" target="_self">
             Java
            </a>
            <a class="duan_name" href="#css" style="border-bottom:none;" target="_self">
             CSS
            </a>
            <a class="duan_name" href="#sql" style="border-bottom:none;" target="_self">
             SQL
            </a>
            <a class="duan_name" href="#plain" style="border:none; " target="_self">
             其它
            </a>
            <span class="arrb">
            </span>
           </div>
          </span>
         </div>
        </form>
       </div>
      </div>
     </div>
    </div>
    <div class="comment_li_outbox">
     <div id="comment_list">
     </div>
    </div>
    <div class="more_comment">
     <div class="trackgin-ad" data-mod="popu_385" id="comment_bar">
     </div>
    </div>
    <h3 class="recommend_tit">
     相关文章推荐
    </h3>
    <div class="recommend_list clearfix">
     <dl class="clearfix csdn-tracking-statistics" data-dsm="post" data-feed-show="false" data-mod="popu_387" data-poputype="feed">
      <dd>
       <h2>
        <a href="/csdnnews/article/details/78042121" strategy="BlogCommendFromBaidu_0" target="_blank">
         十大最受欢迎的 React Native 应用开发编辑器
        </a>
       </h2>
       <div class="summary">
        市面上用于开发工作的编辑器非常多，笔者会经常因为不同的编程语言该如何选择好用的编辑器而感到纠结。而在随后从事 React Native 开发工作过程中，对相应的编辑器做了一些探索和研究，本文总结了一些...
       </div>
       <ul>
        <li class="avatar_img">
         <a href="http://blog.csdn.net/csdnnews" strategy="BlogCommendFromBaidu_0" target="_blank">
          <img alt="csdnnews" src="http://avatar.csdn.net/C/3/E/2_csdnnews.jpg" title="csdnnews"/>
         </a>
        </li>
        <li class="user_name">
         <a href="http://blog.csdn.net/csdnnews">
          csdnnews
         </a>
        </li>
        <li class="time">
         2017-09-20 16:09
        </li>
        <li class="visited_num">
         <i class="icon iconfont icon-read">
         </i>
         <span>
          15345
         </span>
        </li>
       </ul>
      </dd>
     </dl>
     <dl class="clearfix csdn-tracking-statistics" data-dsm="post" data-feed-show="false" data-mod="popu_387" data-poputype="feed">
      <dd>
       <h2>
        <a href="/csdnnews/article/details/78038530" strategy="BlogCommendFromBaidu_1" target="_blank">
         iOS 11 正式版发布，都有哪些新内容？
        </a>
       </h2>
       <div class="summary">
        北京时间 9 月 20 日凌晨 1 点，苹果正式发布了下一代全新操作系统 iOS 11。此外本次的更新也意味着 iOS 彻底与 32 位 App 说了再见。
       </div>
       <ul>
        <li class="avatar_img">
         <a href="http://blog.csdn.net/csdnnews" strategy="BlogCommendFromBaidu_1" target="_blank">
          <img alt="csdnnews" src="http://avatar.csdn.net/C/3/E/2_csdnnews.jpg" title="csdnnews"/>
         </a>
        </li>
        <li class="user_name">
         <a href="http://blog.csdn.net/csdnnews">
          csdnnews
         </a>
        </li>
        <li class="time">
         2017-09-20 11:08
        </li>
        <li class="visited_num">
         <i class="icon iconfont icon-read">
         </i>
         <span>
          8794
         </span>
        </li>
       </ul>
      </dd>
     </dl>
     <!--dl class="clearfix csdn-tracking-statistics" data-mod="popu_393">
                <dt><a href="http://edu.csdn.net/huiyiCourse/series_detail/64?utm_source=blog10" target="_blank"><img class="maxwidth" src="http://img.blog.csdn.net/20170928113144608" alt="" title=""></a></dt>
                <dd>
                    <div class="summary">
                        <h2><a href='http://edu.csdn.net/topic/python1?utm_source=blog10' target='_blank'>伤心啊！年度热门编程语言排行榜出来了...</a></h2>  <div class="summary">近期，IEEE Spectrum 发布了第四届顶级编程语言交互排行榜。结合 10 个线上数据源的 12 个标准，对 48 种语言进行了排行！此外，七牛云许式伟曾说过Go语言会取代Java...气氛... </div> 
                    </div>
                </dd>
            </dl-->
     <script>
      (function() {
		    var s = "_" + Math.random().toString(36).slice(2);
		    document.write('<div id="' + s + '"></div>');
		    (window.slotbydup=window.slotbydup || []).push({
			id: '4765209',
			container: s,
			size: '808,120',
			display: 'inlay-fix'
		    });
		})();
     </script>
     <dl class="clearfix csdn-tracking-statistics" data-dsm="post" data-feed-show="false" data-mod="popu_387" data-poputype="feed">
      <dd>
       <h2>
        <a href="/assin/article/details/2793076" strategy="BlogCommendFromBaidu_2" target="_blank">
         Tomcat服务安装
        </a>
       </h2>
       <div class="summary">
        解压缩版的tomcat的安装及服务安装1、去www.apache.org上下载tomcat手动安装版(.zip)文件，如果是下载WINDOWS安装版本就会自动安装和配置服务2、解压缩下载的tomcat...
       </div>
       <ul>
        <li class="avatar_img">
         <a href="http://blog.csdn.net/assin" strategy="BlogCommendFromBaidu_2" target="_blank">
          <img alt="assin" src="http://avatar.csdn.net/4/3/7/2_assin.jpg" title="assin"/>
         </a>
        </li>
        <li class="user_name">
         <a href="http://blog.csdn.net/assin">
          assin
         </a>
        </li>
        <li class="time">
         2008-08-19 01:11
        </li>
        <li class="visited_num">
         <i class="icon iconfont icon-read">
         </i>
         <span>
          8650
         </span>
        </li>
       </ul>
      </dd>
     </dl>
     <dl class="clearfix csdn-tracking-statistics" data-dsm="post" data-feed-show="false" data-mod="popu_387" data-poputype="feed">
      <dd>
       <h2>
        <a href="/qq_25610673/article/details/55505131" strategy="BlogCommendFromCsdn_5" target="_blank">
         一个封装好的SurfaceView+MediaPlayer开源视频播放器
        </a>
       </h2>
       <div class="summary">
        第一次写博客，写的不好大家见谅哈。

由于我们公司业务是Android电视端，很多都用到了视频播放，而且运用到的地点非常多，自己也入码农的坑也没多久，刚开始在不同的播放页面都写了播放器，也试了ij...
       </div>
       <ul>
        <li class="avatar_img">
         <a href="http://blog.csdn.net/qq_25610673" strategy="BlogCommendFromCsdn_5" target="_blank">
          <img alt="qq_25610673" src="http://avatar.csdn.net/F/F/D/2_qq_25610673.jpg" title="qq_25610673"/>
         </a>
        </li>
        <li class="user_name">
         <a href="http://blog.csdn.net/qq_25610673">
          qq_25610673
         </a>
        </li>
        <li class="time">
         2017-02-17 10:24
        </li>
        <li class="visited_num">
         <i class="icon iconfont icon-read">
         </i>
         <span>
          414
         </span>
        </li>
       </ul>
      </dd>
     </dl>
     <dl class="clearfix csdn-tracking-statistics" data-dsm="post" data-feed-show="false" data-mod="popu_387" data-poputype="feed">
      <dd>
       <h2>
        <a href="/probuing/article/details/52481904" strategy="BlogCommendFromCsdn_8" target="_blank">
         大神之路：重学Android——Android多媒体MediaPlayer
        </a>
       </h2>
       <div class="summary">
        大神之路：重学Android——Android多媒体MediaPlayer
引言
最近发现Android开发中使用的知识越来越不得心应手了，有好多的API方法都记得不太清楚了，所以打算重新学习一遍...
       </div>
       <ul>
        <li class="avatar_img">
         <a href="http://blog.csdn.net/probuing" strategy="BlogCommendFromCsdn_8" target="_blank">
          <img alt="probuing" src="http://avatar.csdn.net/6/6/D/2_probuing.jpg" title="probuing"/>
         </a>
        </li>
        <li class="user_name">
         <a href="http://blog.csdn.net/probuing">
          probuing
         </a>
        </li>
        <li class="time">
         2016-09-09 01:18
        </li>
        <li class="visited_num">
         <i class="icon iconfont icon-read">
         </i>
         <span>
          258
         </span>
        </li>
       </ul>
      </dd>
     </dl>
    </div>
   </main>
   <aside>
    <div class="right_box user_info">
     <dl class="inf_bar clearfix">
      <dt class="csdn-tracking-statistics" data-mod="popu_381">
       <a href="http://blog.csdn.net/jiashuai94" target="_blank">
        <img class="avatar_pic" src="http://avatar.csdn.net/E/7/E/1_jiashuai94.jpg"/>
       </a>
       <span class="medals" title="">
        <svg aria-hidden="true" class="icon">
        </svg>
       </span>
      </dt>
      <dd>
       <h3 class="csdn-tracking-statistics" data-mod="popu_380">
        <a href="http://blog.csdn.net/jiashuai94" id="uid" target="_blank">
         jiashuai94
        </a>
       </h3>
       <span class="csdn-tracking-statistics" data-mod="popu_379">
        <a class="btn btn-redborder-small " id="span_add_follow" target="_self">
         ＋关注
        </a>
       </span>
      </dd>
     </dl>
     <div class="inf_number_box clearfix">
      <dl>
       <dt>
        原创
       </dt>
       <dd>
        48
       </dd>
      </dl>
      <dl>
       <dt>
        粉丝
       </dt>
       <dd id="fan">
        14
       </dd>
      </dl>
      <dl>
       <dt>
        喜欢
       </dt>
       <dd>
        0
       </dd>
      </dl>
      <dl>
       <dt>
        码云
       </dt>
       <dd>
       </dd>
      </dl>
     </div>
     <div class="writings">
      <div class="public_signal clearfix">
       <h3>
        他的最新文章
       </h3>
       <a class="more_z" href="http://blog.csdn.net/jiashuai94" target="_blank">
        <span>
         更多文章
        </span>
       </a>
      </div>
      <ul class="inf_list clearfix csdn-tracking-statistics" data-mod="popu_382">
       <li class="clearfix">
        <a href="/jiashuai94/article/details/78303113" target="_blank">
         用数学思维实现雷达分析图
        </a>
       </li>
       <li class="clearfix">
        <a href="/jiashuai94/article/details/78296307" target="_blank">
         安卓中相机相册调用总结
        </a>
       </li>
       <li class="clearfix">
        <a href="/jiashuai94/article/details/78247337" target="_blank">
         阿里发布的规约插件使用指南
        </a>
       </li>
       <li class="clearfix">
        <a href="/jiashuai94/article/details/78228968" target="_blank">
         使用三阶贝塞尔曲线实现直播中点赞效果
        </a>
       </li>
      </ul>
     </div>
    </div>
    <div class="extension_other csdn-tracking-statistics" data-mod="popu_389">
     <!--u3032528-->
     <div class="flashrecommend">
      <!-- 请置于所有广告位代码之前 -->
      <script src="http://dup.baidustatic.com/js/dm.js">
      </script>
      <!-- 广告位：PC端-博客详情页右侧视窗1（feed流）-300*250 -->
      <script>
       (function() {
    var s = "_" + Math.random().toString(36).slice(2);
    document.write('<div id="' + s + '"></div>');
    (window.slotbydup=window.slotbydup || []).push({
        id: '4770930',
        container: s,
        size: '300,250',
        display: 'inlay-fix'
    });
})();
      </script>
     </div>
    </div>
    <div class="fixRight">
     <div class="right_box padb0 csdn-tracking-statistics" data-mod="popu_391">
      <h3 class="tit">
       <span>
        <em>
         在线课程
        </em>
       </span>
      </h3>
      <ul class="edu_li clearfix">
       <li>
        <div>
         <a href="http://edu.csdn.net/huiyiCourse/series_detail/68?utm_source=wx2" target="_blank">
          <img alt="用户画像系统应用与技术解析" src="http://img.bss.csdn.net/201710200924553321.png" title="用户画像系统应用与技术解析"/>
         </a>
        </div>
        <div>
         <p>
          <a href="http://edu.csdn.net/huiyiCourse/series_detail/68?utm_source=wx2" target="_blank">
           用户画像系统应用与技术解析
          </a>
         </p>
         <p>
          讲师：汪剑
         </p>
        </div>
       </li>
       <li>
        <div>
         <a href="http://edu.csdn.net/huiyiCourse/series_detail/70?utm_source=blog7" target="_blank">
          <img alt="2017 求职面试集训营之VIP服务版" src="http://img.bss.csdn.net/201710200910059870.jpg" title="2017 求职面试集训营之VIP服务版"/>
         </a>
        </div>
        <div>
         <p>
          <a href="http://edu.csdn.net/huiyiCourse/series_detail/70?utm_source=blog7" target="_blank">
           2017 求职面试集训营之VIP服务版
          </a>
         </p>
         <p>
          讲师：刘道宽
         </p>
        </div>
       </li>
      </ul>
     </div>
     <!--u3032529-->
     <!-- <div class="extension_other csdn-tracking-statistics baidu_box" data-mod="popu_395">
								
                <script type="text/javascript" src="http://mpb1.iteye.com/cxpdpmumfaedgm.js"></script>
            </div> -->
     <div class="extension_other csdn-tracking-statistics bottomRcom" data-mod="popu_389" style="position:absolute;z-index:-5;opacity:0;pointer-events:none">
      <!--u3032528-->
      <div class="flashrecommend">
       <script src="http://mpb1.iteye.com/bwocoltlyzdec.js" type="text/javascript">
       </script>
      </div>
     </div>
    </div>
    <div class="user-hotArticle">
     <h3>
      热门文章
     </h3>
     <ul class="hotArticle-list">
      <li>
       <a href="/jiashuai94/article/details/78020994">
        SurfaceView+MediaPlayer封装之路
       </a>
       <div class="read list-left">
        <i class="icon iconfont icon-read">
        </i>
        <span>
         8325
        </span>
       </div>
      </li>
      <li>
       <a href="/jiashuai94/article/details/77639511">
        安卓屏幕完美适配方案——独家秘笈
       </a>
       <div class="read list-left">
        <i class="icon iconfont icon-read">
        </i>
        <span>
         4995
        </span>
       </div>
      </li>
      <li>
       <a href="/jiashuai94/article/details/78142951">
        轻松又酷炫地实现弹幕效果——手把手教学
       </a>
       <div class="read list-left">
        <i class="icon iconfont icon-read">
        </i>
        <span>
         3494
        </span>
       </div>
      </li>
      <li>
       <a href="/jiashuai94/article/details/77991077">
        Android轻松实现代码混淆
       </a>
       <div class="read list-left">
        <i class="icon iconfont icon-read">
        </i>
        <span>
         1322
        </span>
       </div>
      </li>
      <li>
       <a href="/jiashuai94/article/details/77862377">
        Android项目从立项到上线——修仙之路
       </a>
       <div class="read list-left">
        <i class="icon iconfont icon-read">
        </i>
        <span>
         995
        </span>
       </div>
      </li>
     </ul>
    </div>
   </aside>
  </div>
  <div class="left_fixed">
   <div class="left_show_button">
    <span>
     <i class="icon iconfont icon-youjiantou">
     </i>
    </span>
   </div>
   <ul class="left_menu">
    <li>
     <button class="left-fixed-btn btn-like csdn-tracking-statistics" data-mod="popu_373" target="_self">
      <span class="iconbox border_red">
       <i class="icon iconfont icon-dianzan">
       </i>
      </span>
      <span class="txt">
       5
      </span>
     </button>
    </li>
    <li id="blog_artical_directory">
     <button class="left-fixed-btn left_menu_btn csdn-tracking-statistics" data-mod="popu_372" target="_self">
      <span class="iconbox border_black">
       <i class="icon iconfont icon-mulu">
       </i>
      </span>
     </button>
    </li>
    <li class="menu_con">
     <div class="list_father">
      <div class="arr_box">
       <button class="btn-noborder arr-btn scroll-down left_scroll_down">
        <i class="icon iconfont icon-xiajiantou">
        </i>
       </button>
       <button class="btn-noborder arr-btn scroll-up left_scroll_top">
        <i class="icon iconfont icon-shangjiantou">
        </i>
       </button>
      </div>
      <div class="arr">
      </div>
      <div id="csdnBlogDir">
      </div>
     </div>
    </li>
    <li>
     <button class="left-fixed-btn csdn-tracking-statistics" data-mod="popu_374" id="com-quick-collect" target="_self">
      <span class="iconbox border_purple">
       <i class="icon iconfont icon-shoucang">
       </i>
      </span>
     </button>
    </li>
    <li>
     <button class="left-fixed-btn btn-pinglun">
      <span class="iconbox border_purple">
       <i class="icon iconfont icon-pinglun">
       </i>
      </span>
     </button>
    </li>
    <li id="share_box">
     <button class="left-fixed-btn csdn-tracking-statistics" data-mod="popu_375" target="_self">
      <span class="iconbox border_orange">
       <i class="icon iconfont icon-fenxiang">
       </i>
      </span>
     </button>
     <div class="bdsharebuttonbox csdn-tracking-statistics" data-mod="popu_172">
      <div class="outside">
       <span class="iconbox border_red2">
        <i class="icon iconfont icon-xinlang">
        </i>
       </span>
       <a class="bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博">
       </a>
      </div>
      <div class="outside">
       <span class="iconbox border_green">
        <i class="icon iconfont icon-weixin">
        </i>
       </span>
       <a class="bds_weixin" data-cmd="weixin" href="#" title="分享到微信">
       </a>
      </div>
      <div class="outside">
       <span class="iconbox border_blue">
        <i class="icon iconfont icon-QQ">
        </i>
       </span>
       <a class="bds_qzone" data-cmd="qzone" href="#" title="分享到QQ空间">
       </a>
      </div>
     </div>
    </li>
   </ul>
  </div>
  <div class="right_fixed">
   <div class="r_ico">
    <i class="icon iconfont icon-jubao">
    </i>
    <span class="txt" id="reportBtn">
     内容举报
    </span>
   </div>
   <div class="returnTop">
    <i class="icon iconfont icon-fanhuidingbu">
    </i>
    <span>
     返回顶部
    </span>
   </div>
  </div>
  <div id="pop_win">
  </div>
  <div id="popup_mask">
  </div>
  <div class="pop_CA_cover">
  </div>
  <div class="pop pop_CA">
   <div class="CA_header">
    收藏助手
    <span class="cancel_icon" id="fapancle">
    </span>
   </div>
   <iframe frameborder="0" height="360" id="collectIframe" scrolling="no" src="" width="100%">
   </iframe>
  </div>
  <!--举报-->
  <div id="report_dialog" style="top: 250px; left: 343.5px;">
   <div id="panel_report">
    <div class="panel_head">
     不良信息举报
    </div>
    <form class="panel_body" id="frmReport" method="post">
     <table border="0" cellpadding="0" cellspacing="4" class="pop_table">
      <tbody>
       <tr>
        <td colspan="2">
         您举报文章：
         <a href="http://blog.csdn.net/raintungli/article/details/76583070" target="_blank">
          深度学习：神经网络中的前向传播和反向传播算法推导
         </a>
        </td>
       </tr>
       <tr>
        <th style="width:60px;">
         举报原因：
        </th>
        <td id="panel_reporttype">
         <label>
          <input class="report_type" id="report_sex" name="report_type" type="radio" value="1"/>
          色情
         </label>
         <label>
          <input class="report_type" id="report_Politics" name="report_type" type="radio" value="2"/>
          政治
         </label>
         <label>
          <input class="report_type" id="report_copy" name="report_type" type="radio" value="3"/>
          抄袭
         </label>
         <label>
          <input class="report_type" id="report_ad" name="report_type" type="radio" value="4"/>
          广告
         </label>
         <label>
          <input class="report_type" id="report_want" name="report_type" type="radio" value="5"/>
          招聘
         </label>
         <label>
          <input class="report_type" id="report_call" name="report_type" type="radio" value="6"/>
          骂人
         </label>
         <br/>
         <label>
          <input class="report_type" id="report_other" name="report_type" type="radio" value="7"/>
          其他
         </label>
         <input id="report_other_content" maxlength="30" name="report_other_content" style="display: none;" type="text"/>
        </td>
       </tr>
       <tr id="panel_originalurl" style="display: none;">
        <th>
         原文地址：
        </th>
        <td>
         <input id="originalurl" name="originalurl" style="width: 90%;" type="text" value="http://"/>
        </td>
       </tr>
       <tr>
        <th id="sp_reason">
         原因补充：
        </th>
        <td>
         <textarea id="report_description" name="report_description" rows="3" style="width: 300px;"></textarea>
         <p id="sp_n" style="color:#999;margin:0px;padding:0px;">
          (最多只允许输入30个字)
         </p>
        </td>
       </tr>
       <tr>
        <td>
        </td>
        <td>
         <input align="middle" class="btn_1" id="btnSubmitReport" name="submit" src="http://static.blog.csdn.net/images/btn_submit.jpg" type="image"/>
         <span style="padding-left:20px;">
         </span>
         <img align="middle" id="btnCloseReportDialog" src="http://static.blog.csdn.net/images/btn_cancel.jpg"/>
         <div id="error" style="color: Red">
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </form>
   </div>
   <script language="javascript" type="text/javascript">
    var isComment=0;
        //显示隐藏地址
        $(function () {
            if(isComment){
                $("#report_description").attr("disabled",true);
                $("#sp_n").hide();
                $("#sp_reason").html("评论内容：");
            }
            $(".report_type").click(function () {
                $("#panel_originalurl,#report_other_content").hide();
                switch ($(this).val()) {
                    case '3':
                        $("#panel_originalurl").show();
                        $("#originalurl").focus();
                        break;
                    case '7':
                        if(isComment){
                            $("#report_other_content").show().focus();
                        }
                        break;
                }

            });

            $("#frmReport").submit(function () {
                if (!currentUserName) {

                    if (confirm("您的操作必须登录，是否登录？")) {
                        location.href = "http://passport.csdn.net/account/login?from=" + encodeURIComponent(location.href);
                        return false;
                    }
                    return false;
                }

                var reportType = $("input[name=report_type]:checked").val();
                if(!reportType){
                    alert("请选择举报原因！");
                    return false;
                }
                var otherInfo = "";
                switch (reportType) {
                    case '3':
                        otherInfo = $("#originalurl").val();
                        if (otherInfo == ""||otherInfo=="http://") {
                            alert("举报抄袭必须提供原创文章地址！");
                            $("#originalurl").focus();
                            return false;
                        } else if(!checkeURL(otherInfo)) {
                            alert("请输入正确的原创文章地址！");
                            $("#originalurl").focus();
                            return false;
                        }
                        break;
                    case '7':
                        otherInfo = $("#report_other_content").val();
                        if (isComment && !otherInfo) {
                            alert("请填写举报的具体原因！");
                            $("#report_other_content").focus();
                            return false;
                        }
                        if(!isComment){
                            if(!$("#report_description").val()){
                                alert("请填写举报的具体原因！");
                                $("#report_description").focus();
                                return false;
                            }
                        }
                        break;
                }
                if(!isComment){
                    if($("#report_description").val().length>30){
                        alert("举报原因最多只允许输入30个字！");
                        return false;
                    }
                }
                nowTime = {
                  year: new Date().getFullYear(),
                  month: parseInt(new Date().getMonth())+1,
                  day: new Date().getDate(),
                  hours: parseInt(new Date().getHours()),
                  minutes: parseInt(new Date().getMinutes()),
                  seconds: parseInt(new Date().getSeconds())
                }
                var data = {
                    articleId: fileName,
                    commentId: 0,
                    reportType: reportType,
                    originalurl: $("#originalurl").val(),
                    report_other_content: $("#report_other_content").val(),
                    report_description: $("#report_description").val(),
                    currentUserName: currentUserName,
                    updatetime: nowTime.year+'/'+nowTime.month+'/'+nowTime.day+' '+ nowTime.hours+':'+nowTime.minutes+':'+seconds,
                    blogUser: username
                };
                if(!isComment){//如果是举报文章
                    data.report_other_content = data.report_description;
                    // data.report_description = "1. 神经网络这是一个常见的神经网络的图：这是一个常见的三层神经网络的基本构成，Layer L1是输入层，Layer L2是隐含层";
                }

                $.post(blog_address + "/common/report?id="+fileName+"&t=2", data, function (data) {
                    if (data.result == 1){
                        SetError("感谢您的举报，我们会尽快审核！");
                    }else{
                        if (data.content) alert(data.content);
                    }

                });
                return false;
            });

            $("#btnCloseReportDialog").click(function () {
                CloseDiv();
            });

        });

        //提示后关闭方法
        function SetError(error) {
            $("#btnCloseReportDialog").trigger("click");
            alert(error);
            CloseDiv();
        }

        //关闭方法
        function CloseDiv() {

            $.removeMask();
            $("#report_dialog").hide();
            return false;
        }

        //验证url
        function checkeURL(url){
            return /^http(s)?:\/\/([\w-]+\.)+[\w-]+/i.test(url);
        }
   </script>
  </div>
  <script src="http://c.csdnimg.cn/public/common/libs/bootstrap/js/bootstrap.min.js" type="text/javascript">
  </script>
  <script src="http://static.blog.csdn.net/public/res/bower-libs/MathJax/MathJax.js?config=TeX-AMS_HTML" type="text/javascript">
  </script>
  <script src="http://passport.csdn.net/content/loginbox/login.js" type="text/javascript">
  </script>
  <script src="http://static.blog.csdn.net/Skin/skin3-template/js/blog_ver.js?v=2017.033" type="text/javascript">
  </script>
  <script src="http://static.blog.csdn.net/Skin/skin3-template/js/skin2017.js?v=2017.033" type="text/javascript">
  </script>
  <script src="http://static.blog.csdn.net/scripts/cnick.js" type="text/javascript">
  </script>
  <script>
   window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": "", "bdMini": "1", "bdMiniList": false, "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {} }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];
  </script>
  <script type="text/javascript">
   if($(".article_collect li").length==1){$(".article_collect").hide();}
    if($(".article_tags li").length==1){$(".article_tags").hide();}
    $(".edit a").attr("href","http://write.blog.csdn.net/postedit/"+fileName);
    $.each($(".edu_li a"),function(){$(this).attr("href",$(this).attr("href").replace("blog7","blog9"))});
    new CNick('#uid').showNickname();
if($("#fan").html()=="")
{
$("#fan").html(0);	
}
  </script>
 </body>
 <script type="text/javascript">
  var fromjs=$("#fromjs");
    if(fromjs.length>0)
    {                  
        $("#fromjs .markdown_views pre").addClass("prettyprint");       
        prettyPrint();

        $('pre.prettyprint code').each(function () {
            var lines = $(this).text().split('\n').length;
            var $numbering = $('<ul/>').addClass('pre-numbering').hide();
            $(this).addClass('has-numbering').parent().append($numbering);
            for (i = 1; i <= lines; i++) {
                $numbering.append($('<li/>').text(i));
            };
            $numbering.fadeIn(1700);
        });

        $('.pre-numbering li').css("color","#999");             
    }

    $(function(){
        setTimeout(function(){
            $(".math").each(function(index,value){$(this).find("span").last().css("color","#fff"); })
        },500);         
       

    });

    setTimeout(function () {
        $(".toc a[target='_blank']").attr("target", "");
    }, 500);
 </script>
</html>
